---
layout: post
title: Установка Arch linux
---

В данном руководстве рассмотрим минимальную установку arch, позволяющую запустить систему.

## Настройка сети

Для настройки wi-fi необходимо сформировать файл профиля и запустить его. Для формирования файла воспользуемся утилитой `wifi-menu` и назовем новый профиль `me`.

После выбора сети и подтверждения будет сформирован файл `/etc/netctl/me`. Если подключаемся к скрытой сети, необходимо дополнить строки `ESSID` и `Hidden=yes`.

Для запуска выполняем команду:

```
netctl start profile
```

## Разметка диска

Для загрузки системы из EFI достаточно разметить 2 раздела на диске. Использовать будем утилиту `cfdisk`, которая запускается следующим образом (буква диска может отличаться):

```
cfdisk /dev/sda
```

Стоит заметить, что диск рекомендуется размечать в режиме `gpt`.

В результате разметки должны получиться следующие разделы:
  * EFI раздел (достаточно 500M)
  * Linux filesystem (оставшееся место под систему и пользовательские данные)

Форматирование новых разделов производим следующими командами:

```
mkfs.fat -F32 /dev/sda1
mkfs.ext4 /dev/sda2
```

## Mонтирование

Далее необходимо смонтировать разделы к текущей системе:

```
mount /dev/sda2 /mnt

mkdir /mnt/boot
mkdir /mnt/boot/efi

mount /dev/sda1 /mnt/boot/efi
```

## Установка системы

Вся установка системы заключается в нескольких командах:

```
pacman -Syu
pacstrap /mnt base base-devel
```

Для сохранения точкек монтирования необходимо выполнить:

```
genfstab -U /mnt >> /mnt/etc/fstab
```

## Настройка

Необходимо выполнить несколько операций под только что установленной системой. Что бы войти в систему без перезапуска выполняем:

```
arch-chroot /mnt
```

Все последующие операции нужно производить в только что установленной системе (не LiveCD).

Начальная файловая система настраивается следующим образом:

```
mkinitcpio -p linux
```

Для работы wi-fi в новой системе необходим дополнительный пакет (установить его потом мы не сможем, придется опять заходить через LiveCD):

```
pacman -S wpa_supplicant
```

На этом шаге мы можем взять уже имеющиеся профиль wi-fi, либо оставить его повторное создание до следующего перезапуска в уже новой системе. Для копирования текущего профиля необходимо:
  * выйти из текущей системы в систему LiveCD
  * скопировать `/etc/netctl/me` в `/mnt/etc/netctl/me`
  * настроить запуск профиля по умолчанию командой `netctl enable me`

### Загрузчик

Настройка загрузчика также производится в новой системе. Для этого надо установить `grub` и настроить его на целевом диске, после чего сформировать конфиг файлы:

```
pacman -S grub efibootmgr
grub-install /dev/sda
grub-mkconfig -o /boot/grub/grub.cfg
```
